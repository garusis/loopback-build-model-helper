{"version":3,"sources":["index.js"],"names":["app","ModelBuilder","OwnModel","LoopbackModel","Base","Model","config","settings","wrapFunction","fn","fnName","collection","isFunction","oldFn","args","toArray","cb","length","pop","push","apply","response","process","nextTick","assing","forEach","prototype","assign","remoteMethod","name","options","build","resolve","reject","once"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;AAEA;;;;AACA;;;;;;AAEA,IAAIA,YAAJ;;AAEA,SAASC,YAAT,CAAsBC,QAAtB,EAAgCC,aAAhC,EAA+C;AAC3C,SAAKC,IAAL,GAAYF,QAAZ;AACA,SAAKG,KAAL,GAAaF,aAAb;AACH;;AAEDF,aAAaK,MAAb,GAAsB,UAAUC,QAAV,EAAoB;AACtCP,UAAMO,SAASP,GAAf;AACH,CAFD;;AAIA,SAASQ,YAAT,CAAsBC,EAAtB,EAA0BC,MAA1B,EAAkCC,UAAlC,EAA8C;AAC1C,QAAI,CAAC,iBAAEC,UAAF,CAAaH,EAAb,CAAL,EAAuB;;AAEvB,QAAII,QAAQF,WAAWD,MAAX,KAAsB,KAAlC;;AAEAC,eAAWD,MAAX,+DAAqB;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AACbI,4BADa,GACN,iBAAEC,OAAF,QADM;AAEbC,0BAFa;;AAGjB,4BAAI,iBAAEJ,UAAF,CAAaE,KAAKA,KAAKG,MAAL,GAAc,CAAnB,CAAb,CAAJ,EAAyCD,KAAKF,KAAKI,GAAL,EAAL;AACzC,4BAAIL,KAAJ,EAAWC,KAAKK,IAAL,CAAUN,KAAV;;AAJM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDAOQJ,GAAGW,KAAH,QAAeN,IAAf,CAPR;;AAAA;AAOTO,oDAPS;;AAAA,iDAQTL,EARS;AAAA;AAAA;AAAA;;AAAA;AAAA,mDAQEM,QAAQC,QAAR,CAAiB;AAAA,2DAAMP,GAAG,IAAH,EAASK,QAAT,CAAN;AAAA,iDAAjB;AARF;;AAAA;AAAA;AAAA,mDASNA;AATM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA,6BAWTL,EAXS;AAAA;AAAA;AAAA;;AAAA,0DAWEM,QAAQC,QAAR,CAAiB;AAAA,mCAAMP,gBAAN;AAAA,yBAAjB,CAXF;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAArB;AAeH;;AAGDf,aAAauB,MAAb,GAAsB,UAAUpB,IAAV,EAAgBC,KAAhB,EAAuB;AACzC,qBAAEoB,OAAF,CAAUrB,IAAV,EAAgBI,YAAhB;AACA,qBAAEiB,OAAF,CAAUrB,KAAKsB,SAAf,EAA0BlB,YAA1B;;AAEA,qBAAEmB,MAAF,CAAStB,KAAT,EAAgBD,IAAhB;AACA,qBAAEuB,MAAF,CAAStB,MAAMqB,SAAf,EAA0BtB,KAAKsB,SAA/B;AACH,CAND;;AASAzB,aAAayB,SAAb,CAAuBE,YAAvB,GAAsC,UAAUC,IAAV,EAAgBC,OAAhB,EAAyB;AAC3D,SAAKzB,KAAL,CAAWuB,YAAX,CAAwBC,IAAxB,EAA8BC,OAA9B;AACH,CAFD;;AAIA;;;;;;AAMA7B,aAAayB,SAAb,CAAuBK,KAAvB,GAA+B,YAAY;AAAA;;AACvC,WAAO,uBAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpCjC,YAAIkC,IAAJ,CAAS,QAAT,EAAmB,YAAM;AACrBjC,yBAAauB,MAAb,CAAoB,OAAKpB,IAAzB,EAA+B,OAAKC,KAApC;AACA2B,oBAAQ,OAAK5B,IAAb;AACH,SAHD;AAIH,KALM,CAAP;AAMH,CAPD;;AAUA;;;;kBAIeH,Y","file":"index.js","sourcesContent":["\"use strict\"\n\nimport _ from \"lodash\"\nimport Promise from \"bluebird\"\n\nlet app\n\nfunction ModelBuilder(OwnModel, LoopbackModel) {\n    this.Base = OwnModel\n    this.Model = LoopbackModel\n}\n\nModelBuilder.config = function (settings) {\n    app = settings.app\n}\n\nfunction wrapFunction(fn, fnName, collection) {\n    if (!_.isFunction(fn)) return\n\n    let oldFn = collection[fnName] || false\n\n    collection[fnName] = async function () {\n        let args = _.toArray(arguments)\n        let cb\n        if (_.isFunction(args[args.length - 1])) cb = args.pop()\n        if (oldFn) args.push(oldFn)\n\n        try {\n            let response = await fn.apply(this, args)\n            if (cb) return process.nextTick(() => cb(null, response))\n            return response\n        } catch (err) {\n            if (cb) return process.nextTick(() => cb(err))\n            throw err\n        }\n    }\n}\n\n\nModelBuilder.assing = function (Base, Model) {\n    _.forEach(Base, wrapFunction)\n    _.forEach(Base.prototype, wrapFunction)\n\n    _.assign(Model, Base)\n    _.assign(Model.prototype, Base.prototype)\n}\n\n\nModelBuilder.prototype.remoteMethod = function (name, options) {\n    this.Model.remoteMethod(name, options)\n}\n\n/**\n *\n * @param Base\n * @param Model\n * @return {Promise}\n */\nModelBuilder.prototype.build = function () {\n    return new Promise((resolve, reject) => {\n        app.once(\"booted\", () => {\n            ModelBuilder.assing(this.Base, this.Model)\n            resolve(this.Base)\n        })\n    })\n}\n\n\n/**\n * ModelBuilder class exists to allow you to effectively use the Webstorm autocomplementation tools.\n * @constructor\n */\nexport default ModelBuilder"],"sourceRoot":"./"}